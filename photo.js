var cameraStream,cameraStreamVideoElement,cameraStreamSize;function getVideoStream(e){return navigator.mediaDevices.getUserMedia({video:{facingMode:e?"user":"environment"},audio:!1})}function stopCamera(){cameraStream?.getTracks()?.forEach((e=>e.stop()))}async function getAllCameraIds(){return(await navigator.mediaDevices.enumerateDevices()).filter((e=>"videoinput"===e.kind)).map((e=>e.deviceId))}async function switchCameraStream(e){let a=await getAllCameraIds(),t=e.getVideoTracks()[0].getSettings().deviceId,r=a.indexOf(t);return e?.getTracks()?.forEach((e=>e.stop())),await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a[1-r]}},audio:!1})}async function switchCamera(){cameraStream&&(cameraStream=await switchCameraStream(cameraStream),startVideoFromCameraStream())}async function startCamera(e,a){cameraStreamVideoElement=e,cameraStreamSize=a,cameraStream=await getVideoStream(!0),startVideoFromCameraStream()}function startVideoFromCameraStream(){cameraStreamVideoElement.srcObject=cameraStream,cameraStreamVideoElement.onloadedmetadata=function(e){cameraStreamVideoElement.videoWidth>cameraStreamVideoElement.videoHeight?(cameraStreamVideoElement.setAttribute("height",cameraStreamSize),cameraStreamVideoElement.removeAttribute("width")):(cameraStreamVideoElement.setAttribute("width",cameraStreamSize),cameraStreamVideoElement.removeAttribute("height")),cameraStreamVideoElement.play()}}function takePhoto(e,a,t){var r=e.videoWidth/e.videoHeight;if(r>1)var i=t,m=t*r;else i=t/r,m=t;var o=.5*(t-m),c=.5*(t-i);a.width=t,a.height=t,a.getContext("2d").drawImage(e,o,c,m,i),stopCamera(),a.style.width=t}function canvasToBlob(e,a="image/jpeg",t){return new Promise((async function(r,i){e.toBlob(r,a,t)}))}