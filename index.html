<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LectureSeats</title>
  <link rel="icon" type="image/x-icon" href="/lecture-seats-256.png">
  <!-- qr code generator amd scanner -->
  <script type="text/javascript" src="https://unpkg.com/@zxing/library@0.20.0"></script>
  <!-- photo -->
  <script src="photo.js"></script>
  <!-- geolocation map -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <!-- firebase init -->
  <script src="firebase.mjs" type="module"></script>
  <!-- stylesheet and icons -->
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
</head>

<body>
  
  <div id="header">
    <a href="#" id="title">Lecture<span class="themeColor">Seats</span></a>
    <span id="user" onclick="showInMain('profile')">
      <span id="userDisplayName"></span>
    </span>
  </div>
  
  <div id="signin" class="hidden">
    
    <div id="signInWithEmailPassword">
      <div>
        <table>
          <tr>
            <td>Email:</td>
            <td><input id="signInEmailInput"><span class="domainName"></span></td>
          </tr>
          <tr>
            <td>Password:</td>
            <td><input type="password" id="signInPasswordInput"></td>
          </tr>
        </table>
        <button onclick="signInButtonClick()">Sign In</button>
        <span class="spacer"></span>
        <button onclick="registerButtonClick()">Register</button>
      </div>
      <div class="separator"></div>
      <div>
        Forgot password?
        <li><a href="#" onclick="resetPassword()">Reset password</a></li>
        <li><a href="#" onclick="showPasswordlessSignin();">Sign in without a password</a> (we'll email you a sign-in link)</li>
      </div>
    </div>
    
    <div id="signinSendEmail" class="flexcol">
      <div>
        Please enter your <span class="domainName"></span> username to sign in
        <br>
        (a link for signing in will be sent to your email).
      </div>
      <div>
        <input id="signInSendEmailInput"><span class="domainName"></span>
      </div>
      <button onclick="signInSendButtonClick()">Send sign-in link</button>
      <div class="separator"></div>
      <div>
        <small>Please delete the email with the sign-in link after you use it to sign in (that link will be disabled once it is used).</small>
      </div>
      <div>
        Having trouble signing in via an email link?<br>
        Click <a href="#" onclick="showInSignin('signInWithEmailPassword');">here</a> to use a password-based sign-in option.
      </div>
    </div>
    
    <div id="signinConfirmEmail" class="flexcol">
      <div>
        Please enter your <span class="domainName"></span> username to complete sign-in.
      </div>
      <div>
        <input id="signInConfirmEmailInput"><span class="domainName"></span>
      </div>
      <button onclick="signInCompleteButtonClick()">Sign in</button>
      <div class="separator"></div>
      <div>
        If you did got to this page by error (rather than by clicking a sign-in link from your email), or if you are having another issue, please choose one of the links below to get back to a sign-in screen:
        <li><a href="#" onclick="showInSignin('signInWithEmailPassword')">Sign in using email/password</a></li>
        <li><a href="#" onclick="showInSignin('signinSendEmail')">Sign in without a password</a> (we'll email you a sign-in link)</li>
      </div>
    </div>
    
    <div id="signinLinkSent" class="flexcol">
      <div></div>
      <div class="separator"></div>
      <div class="flexcol">
        <div>If you did not receive an email with the sign-in link, please wait a few minutes before trying to send another one.</div>
        <div>If the email was sent to the wrong email address or the sign-in link is not working click the button below to try again.</div>
        <button onclick="hideSigninLinkSent()">Send another sign-in email...</button>
        <div class="separator"></div>
        <div>
          Having trouble signing in via an email link?<br>
          Click <a href="#" onclick="showInSignin('signInWithEmailPassword');">here</a> to use a password-based sign-in option.
        </div>
      </div>
    </div>
    
  </div>
  
  <div id="main" class="hidden">
    
    <div id="sections">
      <select id="semesterSelect"><option disabled selected value>Select Semester</option></select>
      <div id="instructorSections" class="sectionCards hidden" name="Sections I'm teaching">
        <div id="addInstructorSectionBtn" class="sectionCard center" onclick="createNewSection()"><i class="material-icons">add_circle</i></div>
      </div>
      <div id="studentSections" class="sectionCards hidden" name="Sections I'm enrolled in">
        <div id="addStudentSectionBtn" class="sectionCard center" onclick="showAvailableStudentSections()"><i class="material-icons">add_circle</i></div>
      </div>
    </div>
    
    <div id="addInstructorSection">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div class="menuTitle">Create New Section</div>
      Semester:
      <select id="sectionSemesterSelect"><option disabled selected value></option></select>
      Section Id:
      <input id="sectionIdInput" placeholder="e.g., CS-195-001">
      Additional Id's (i.e., cross-listed; one section id per line):
      <textarea id="sectionCrosslistInput"></textarea>
      Pattern (days/times):
      <input id="sectionPatternInput" placeholder="e.g., TR 8:30AM-9:45AM">
      Room:
      <select id="sectionRoomSelect"><option disabled selected value></option></select>
      Instructor Email(s) (one email per line):
      <textarea id="sectionInstructorEmailsInput"></textarea>
      Instructor Name(s):
      <textarea id="sectionInstructorNamesInput"></textarea>
      <div>
        <input type="checkbox" id="sectionLocRequiredCheckbox" checked="checked">
        <label for="sectionLocRequiredCheckbox">Location required</label>
      </div>
      <div>
        <input type="checkbox" id="sectionSeatRequiredCheckbox">
        <label for="sectionSeatRequiredCheckbox">Seat code required</label>
      </div>
      <div>
        <input type="checkbox" id="sectionPhotoRequiredCheckbox">
        <label for="sectionPhotoRequiredCheckbox">Photo required</label>
      </div>
      <!-- <div>
        <input type="checkbox" id="allowEnroll"><label for="allowEnroll">Allow students to self-enroll</label>
      </div> -->
      <button id="sectionSubmitBtn">Save Section</button>
      <button id="sectionDeleteBtn" class="hidden">Delete Section</button>
    </div>
    
    <div id="selectStudentSection">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div class="menuTitle">Select section where you are a student</div>
      <div id="availableStudentSections" class="sectionCards"></div>
    </div>
    
    <div id="profile">
      <div>
        <!-- <div id="displayEmail"></div> -->
        <br>
        Preferred Name:
        <input id="nameInput" placeholder="Enter your name">
        <button id="saveNameBtn" class="hidden">Save Name</button>
      </div>
      <button id="sectionsBtn" class="big" onclick="showInMain('sections')">My Sections</button>
      <!-- for instructors and admins -->
      <button id="allSectionsBtn" class="big hidden" onclick="showInMain('allSections')">All Sections</button>
      <button id="roomsBtn" class="big hidden" onclick="showInMain('rooms')">Rooms</button>
      <div class="separator"></div>
      <!-- logout button -->
      <button id="logoutBtn" class="big" onclick="signOut()">Sign Out</button>
    </div>
    
    <!-- for instructors and admins -->
    <div id="rooms">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
    </div>
    
    <div id="allSections">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
    </div>
    
    <!-- for instructors -->
    <div id="getAttendance">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div>
        <span id="getAttendanceSectionId"></span>
        <span id="getAttendanceCrossListIds"></span>
      </div>
      <div class="flexrow">
        <div id="getAttendanceSectionInfo"></div>
        <i class="material-icons" id="getAttendanceEditBtn" onclick>edit</i>
      </div>
      Attendance passcode:
      <div class="flexrow">
        <input id="getAttendanceClassCodeInput">
        <i class="material-icons" onclick="randomAttendanceClassCodeClick()" id="randomAttendanceClassCodeBtn">autorenew</i>
        <i class="material-icons hidden" onclick="createQRClick()" id="createQRCodeBtn">qr_code</i>
      </div>
      <div id="collectingAttendanceDiv">
        <span id="collectingAttendance">Collect</span>
        attendance for the next
        <span id="minutesToCollectAttendance" contenteditable="true">75</span>
        minutes
      </div>
      <button id="collectAttendanceBtn" onclick="collectAttendanceBtnClick()">Start</button>
      <div id="currentAttendance" class="flexrow hidden">
        <span class="pre"></span>
        <i class="material-icons" onclick="spinOnce(this);refreshCurrentAttendance(true)">autorenew</i>
      </div>
      <div class="separator"></div>
      <div class="flexrow vertical-center">
        <button onclick="showAttendanceTable()"><i class="material-icons">group view_list</i></button>
        <button onclick="showRoom()"><i class="material-icons">event_seat event_seat</i></button>
        <span class="spacer"></span>
        <button onclick="showLearnNames()"><i class="material-symbols-outlined">recent_actors play_arrow</i></button>
      </div>
      <div id="QRcode" class="hidden"></div>
    </div>
    
    <!-- <div id="QRcode" class="center" onclick="navigateBack()"></div> -->
    
    <div id="attendanceTableScreen">
      <!-- navigation controls -->
      <div class="flexrow">
        <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
        <button onclick="navigateBack();showRoom()"><i class="material-icons">event_seat event_seat</i></button>
        <button onclick="spinOnce(this.firstChild);createAttendanceTable(true)"><i class="material-icons">autorenew</i></button>
      </div>
      <!-- table action controls -->
      <div class="flexrow">
        <i onclick="attendanceTableSelectCols()" class="material-symbols-outlined">page_info</i>
        <i onclick="attendanceTableFitToWidth()" class="material-symbols-outlined">fit_width</i>
        <i onclick="attendanceColFirst()" class="material-icons">first_page</i>
        <i onclick="attendanceColLeft()" class="material-icons">navigate_before</i>
        <i class="material-icons" onclick="showAllAttendanceCols()">date_range</i>
        <i onclick="attendanceColRight()" class="material-icons">navigate_next</i>
        <i onclick="attendanceColLast()" class="material-icons">last_page</i>
        <i onclick="showHide('attendanceTableOptions')" class="material-symbols-outlined">more_horiz</i>
      </div>
      <!-- attendance options -->
      <div class="flexcol hidden" id="attendanceTableOptions">
        <i class="closeBtn material-icons" onclick="hide('attendanceTableOptions')">close</i>
        <div class="flexrow">
          <button id="downloadAttendanceBtn" onclick="downloadAttendanceRecord()"><i class="material-symbols-outlined">download</i></button>
          <button onclick="addStudentBtnClick()"><i class="material-icons">person_add</i></button>
          <datalist id="addStudentUserSelectDataList"></datalist>
        </div>
        <div>
          <small>
            +<input id="minLateInput" type="number" step="1" min="5" max="200" maxlength="1" size="1" oninput="createAttendanceTable()"><label for="minLateInput">min is considered late</label>
            <br>
            <label for="pointsLateInput">Points (out of 100) for late attendance </label><input id="pointsLateInput" type="number" step="1" min="0" max="100" value="50"  maxlength="3" size="3" oninput="createAttendanceTable()">
          </small>
        </div>
        <div onclick="classLocPrompt()">
          <i class="material-icons">location_on</i>
          <small id="classLocation"></small>
        </div>
      </div>
      <!-- attendance table -->
      <div id="attendancesHolder">
        <div id="attendances"></div>
      </div>
    </div>
    
    <div id="room">
      <!-- navigation controls -->
      <div class="flexrow">
        <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
        <button onclick="navigateBack();setTimeout(showAttendanceTable,100)"><i class="material-icons">group view_list</i></button>
        <button onclick="spinOnce(this.firstElementChild);showRoom(true)"><i class="material-icons">autorenew</i></button>
      </div>
      <!-- room map options -->
      <div class="flexrow vertical-center">
        <span>
          Zoom: -
          <input id="roomMapZoom" type="range" min="0.5" max="4" value="1" step="0.1" oninput="changeRoomMapSize(this)">
          +
        </span>
        <span class="spacer"></span>
        <span>
          <input type="checkbox" checked="true" id="showNamesOnRoomMap" oninput="roomNames(this.checked)"><label for="showNamesOnRoomMap">Show names</label>
        </span>
      </div>
      <div id="roomMapHolder">
        <div id="roomMap"></div>
        <div class="h200"></div>
      </div>
    </div>
    
    <div id="learnNames">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div id="learnNamesMain">
        <img id="learnNamesImg"  onclick="learnNamesImgClick()" src="user-icon.png">
        <div id="learnNamesName" onclick="learnNamesNameClick()" class="hideName"></div>
        <button id="learnNamesNextBtn" onclick="learnNamesNextBtnClick()">Next</button>
        <button id="learnNamesPrevBtn" onclick="learnNamesPrevBtnClick()" class="hidden">Previous</button>
        <button id="learnNamesRemoveBtn" onclick="learnNamesRemoveBtnClick()">I know them 🙂</button>
      </div>
      <div id="learnNamesDone" class="hidden">
        <p>All Done!</p>
        <p>You have learned all student names in this section!</p>
        <p>:)</p>
      </div>
    </div>
    
    <!-- for students -->
    <div id="markAttendance">
      <button onclick="navigateBack()" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div id="markAttendanceSectionId"></div>
      <div id="attendanceMarked"></div>
      <label class="required" for="markAttendanceClassCodeInput">Attendance passcode:</label>
      <div class="flexrow w300">
        <input id="markAttendanceClassCodeInput" class="grow" oninput="checkMissingAttendanceInfo()">
        <i class="material-symbols-outlined" onclick="openQRreader('markAttendanceClassCodeInput')">qr_code_scanner</i>
      </div>
      <label for="markAttendanceSeatCodeInput">Seat code:</label>
      <div class="flexrow w300">
        <input id="markAttendanceSeatCodeInput" class="grow" oninput="checkMissingAttendanceInfo()">
        <i class="material-symbols-outlined" onclick="openQRreader('markAttendanceSeatCodeInput')">barcode_scanner</i>
      </div>
      <label for="selfieCanvas">Selfie:</label>
      <div class="flexrow vertical-center">
        <div class="selfieContainer">
          <img id="defaultSelfieImg" class="full-size" src="user-icon.png" onclick="enableSelfieCamera()">
          <canvas id="selfieCanvas" class="hidden" onclick="enableSelfieCamera()"></canvas>
          <video id="selfieVideo" class="hidden" width="300" autoplay playsinline onclick="snapPhoto()"></video>
        </div>
        <i id="addPhotoBtn" class="material-icons large-icon" onclick="enableSelfieCamera()">add_a_photo</i>
        <i id="snapPhotoBtn" class="material-symbols-outlined large-icon hidden" onclick="snapPhoto()">camera</i>
        <i id="switchPhotoBtn" class="material-symbols-outlined large-icon hidden" onclick="switchCamera()">cameraswitch</i>
      </div>
      <label for="markAttendanceLocation">Location:</label>
      <span id="markAttendanceLocation" class="hidden">
        &nbsp;
        <i class="material-symbols-outlined">location_on</i> ✔️
      </span>
      <div id="markAttendanceLocationOff" class="hidden">
        <i class="material-symbols-outlined">location_off</i> Your location sharing is off
        <br>
        <small>(turn on location-sharing and refresh page to enable)</small>
        <i class="material-icons" onclick="spinOnce(this);checkMissingAttendanceInfo();">autorenew</i>
      </div>
      <div id="markAttendanceLocationOffButRequired" class="hidden">
        <i class="material-symbols-outlined">location_off</i> ❌
        Please turn on location sharing and refresh.
        <i class="material-icons" onclick="spinOnce(this);checkMissingAttendanceInfo();">autorenew</i>
      </div>
      <button id="markAttendanceButton" disabled>Mark Attendance</button>
      <div  id="markAttendanceRequirements" class="w300 dashed-border">
        Missing required information:
        <ul id="markAttendanceRequirementsList">
          <li>Attendance passcode</li>
        </ul>
        <div class="required footnote">indicates required field</div>
      </div>
      <div class="separator"></div>
      <br>
      <button id="markAttendanceRemoveButton"><i class="material-symbols-outlined">delete</i> Remove <span id="markAttendanceRemoveButtonSectionId"></span> from My Sections</button>
      <br>
    </div>
    
    <div id="QRreader">
      <button onclick="navigateBack()" id="QRReaderBackButton" class="back"><i class="material-icons">arrow_back_ios</i>Back</button>
      <div class="w300 center">
        <video id="QRreaderVideo" class="full-size"></video>
        <i id="switchQrCameraBtn" class="material-symbols-outlined large-icon" onclick="switchQRCamera()">cameraswitch</i>
      </div>
    </div>
    
  </div>
  
  
  <div id="accessibility" class="flexcol">
    <i class="material-icons" onclick="changeFontSize(1)">text_increase</i>
    <i class="material-icons" onclick="changeFontSize(-1)">text_decrease</i>
    <i class="material-icons" id="theme-switch" onclick="toggleDarkMode()">light_mode</i>
  </div>
  
  <div id="loading" class="hidden center">
    <div id="loader"></div>
    <div>Loading...</div>
  </div>
  
  <div id="prompt" class="hidden center">
    <div>
      <div id="promptFormTitle"></div>
      <form id="promptForm"></form>
      <div id="promptButtons"></div>
    </div>
  </div>
  
  <div id="toast" class="hidden">
    <span id="toastMessage"></span>
  </div>
  
</body>
<script src="main.js"></script>
</html>