import{initializeApp}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";import{getAnalytics}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-analytics.js";import{getAuth,onAuthStateChanged,sendSignInLinkToEmail,signInWithEmailLink,isSignInWithEmailLink,createUserWithEmailAndPassword,signInWithEmailAndPassword,sendPasswordResetEmail,sendEmailVerification}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";import{getFirestore,serverTimestamp,Timestamp,collection,doc,addDoc,setDoc,getDocs,getDoc,updateDoc,deleteDoc,writeBatch,deleteField,FieldPath,query,where,documentId,orderBy,startAt,endBefore,limit,getCountFromServer}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";import{getStorage,ref,uploadBytes,getBytes,getMetadata,getDownloadURL,list,listAll,deleteObject}from"https://www.gstatic.com/firebasejs/10.7.0/firebase-storage.js";const API_KEY="AIzaSyDtn21mi-DzG-TGErzkkaNqUifB-cC1KQQ",firebaseConfig={apiKey:API_KEY,authDomain:"lectureseats.firebaseapp.com",projectId:"lectureseats",storageBucket:"lectureseats.appspot.com",messagingSenderId:"911998665124",appId:"1:911998665124:web:27b4b44bcc6cd3b7054131",measurementId:"G-VT95CQX9DC"},app=initializeApp(firebaseConfig),analytics=getAnalytics(app);window.auth=getAuth(),window.onAuth=e=>onAuthStateChanged(window.auth,e),window.isSignInWithEmailLink=isSignInWithEmailLink,window.passwordReset=function(e){return sendPasswordResetEmail(window.auth,e+DOMAIN)},window.signIn=function(e,t){return signInWithEmailAndPassword(window.auth,e+DOMAIN,t)},window.signUp=function(e,t){return createUserWithEmailAndPassword(window.auth,e.toLowerCase()+DOMAIN,t)},window.sendEmailLink=async function(e){try{await sendSignInLinkToEmail(window.auth,e+DOMAIN,{url:window.location.href,handleCodeInApp:!0})}catch(e){return{error:e.code}}},window.trySigningInWithLink=async function(e,t){try{return await signInWithEmailLink(window.auth,t+DOMAIN,e)}catch(e){return{error:e.code}}},window.sendEmailVerification=sendEmailVerification;const storage=getStorage();var downloadURLs={};async function copyFile(e,t){let r=await getMetadata(e),o=await getBytes(e);return await uploadBytes(t,o,r)}async function getOneFileInPath(e){if(!navigator.onLine)return{error:"You are offline."};try{let t=await listAll(ref(storage,e));if(t.items.length)return t.items[0];for(let e of t.prefixes){let t=getOneFileInPath(e);if(t)return t}}catch(e){return{error:e.code}}}window.downloadURLs=downloadURLs,window.storage=storage,window.storageRef=e=>ref(storage,e),window.uploadFile=async function(e,t){if(!navigator.onLine)return{error:"You are offline."};try{return await uploadBytes(ref(storage,e),t)}catch(e){return{error:e.code}}},window.moveFiles=async function(e,t){if(!navigator.onLine)return{error:"You are offline."};let r=new Set,o=new Set,n=0,i=0,a={ok:0,okCopy:0};for(let d of(await list(ref(storage,e))).items){try{await copyFile(d,ref(storage,t+"/"+d.name)),a.okCopy++,delete downloadURLs[e+"/"+d.name]}catch(e){n++,r.add(e.code)}try{await deleteObject(d),a.ok++}catch(e){i++,o.add(e.code)}}return n&&(a.error=`Failed to copy ${n} of ${n+a.okCopy} files (${[...r]})`),i&&(a.warn=`Failed to delete ${i} of the old files after copying (${[...o]})`),a},window.deleteFile=async function(e){if(!navigator.onLine)return{error:"You are offline."};try{return await deleteObject(ref(storage,e)),{ok:1}}catch(e){return"storage/object-not-found"===e.code?{ok:0}:{error:e.code}}},window.deleteFiles=async function(e){if(!navigator.onLine)return{error:"You are offline."};let t=[],r=new Set,o={};for(let o of(await list(ref(storage,e))).items)try{t.push(await deleteObject(o))}catch(e){r.add(e.code)}return t.length&&(o.ok=t.length),1===r.size?o.error=[...r][0]:r.size&&(o.error=[...r]),o},window.getLinkFromStoragePath=async function(e){if(!navigator.onLine)return{error:"You are offline."};if(e)try{let t=downloadURLs[e];return t||(t=downloadURLs[e]=await getDownloadURL(ref(storage,e))),t}catch(e){return{error:e.code}}},window.getOneLinkFromStoragePath=async function(e){if(!navigator.onLine)return{error:"You are offline."};if(e)try{for(let t in downloadURLs)if(t.startsWith(e+"/"))return downloadURLs[t];let t=await getOneFileInPath(e);return!t||t.error?t:(downloadURLs[t.fullPath]=await getDownloadURL(t),downloadURLs[t.fullPath])}catch(e){return{error:e.code}}};const DATABASE=getFirestore(app);window.db={},window.db.serverTimestamp=serverTimestamp,window.db.Timestamp=Timestamp,window.db.now=()=>Timestamp.now().seconds,window.db.makeTimestamp=function(e,t=0){return e.constructor===Array&&(e=e.join(" ")),db.Timestamp.fromMillis(new Date(e).getTime()+6e4*t)},window.db.fieldPath=(...e)=>new FieldPath(...e),window.db.deleteField=deleteField,window.db.where=where,window.db.orderBy=orderBy,window.db.startAt=startAt,window.db.endBefore=endBefore,window.db.limit=limit,window.db.documentId=documentId,window.db.startsWith=(e,t)=>[where(e,">=",t),where(e,"<",t+"ï£¿")],window.db.count=async function(e,...t){try{let r;return r=t?await getCountFromServer(query(collection(DATABASE,e),...t)):await getCountFromServer(collection(DATABASE,e)),r.data().count}catch(e){return{error:e.code||"unknown error"}}},window.db.find=async function(e,...t){if(!navigator.onLine)return{error:"You are offline."};try{if(t?.length)var r=await getDocs(query(collection(DATABASE,e),...t));else r=await getDocs(collection(DATABASE,e));let o={};return r.docs.forEach((e=>o[e.id]=e.data())),o}catch(e){return{error:e.code||"unknown error"}}},window.db.getDoc=async function(e,t){if(!navigator.onLine)return{error:"You are offline."};try{var r=await getDoc(doc(DATABASE,e,t));return r.exists()?r.data():null}catch(e){return{error:e.code||"unknown error"}}},window.db.deleteOne=async function(e,t){if(!navigator.onLine)return{error:"You are offline."};try{await deleteDoc(doc(DATABASE,e,t))}catch(e){return{error:e.code||"unknown error"}}},window.db.insertOne=async function(e,t,r){if(!navigator.onLine)return{error:"You are offline."};try{if(t){await setDoc(doc(DATABASE,e,t),r);return t}return(await addDoc(collection(DATABASE,e),r)).id}catch(e){return{error:e.code||"unknown error"}}},window.db.updateOne=async function(e,t,r,...o){if(!navigator.onLine)return{error:"You are offline."};try{return o.length?await updateDoc(doc(DATABASE,e,t),r,...o):await updateDoc(doc(DATABASE,e,t),r),!0}catch(e){return{error:e.code||"unknown error"}}},window.db.updateBatch=async function(...e){if(!navigator.onLine)return{error:"You are offline."};try{const t=writeBatch(DATABASE);for(let r of e)t.update(doc(DATABASE,r.collection,r.id),r.data);return await t.commit(),!0}catch(e){return{error:e.code||"unknown error"}}},window.db.upsertOne=async function(e,t,r){if(!navigator.onLine)return{error:"You are offline."};try{return await setDoc(doc(DATABASE,e,t),r,{merge:!0}),!0}catch(e){return{error:e.code||"unknown error"}}},window.db.upsertBatch=async function(...e){if(!navigator.onLine)return{error:"You are offline."};try{const t=writeBatch(DATABASE);for(let r of e)t.set(doc(DATABASE,r.collection,r.id),r.data,{merge:!0});return await t.commit(),!0}catch(e){return{error:e.code||"unknown error"}}};