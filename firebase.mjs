import{initializeApp}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";import{getAuth,onAuthStateChanged,createUserWithEmailAndPassword,signInWithEmailAndPassword,sendPasswordResetEmail}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-auth.js";import{getFirestore,serverTimestamp,Timestamp,collection,doc,addDoc,setDoc,getDocs,getDoc,updateDoc,arrayUnion,arrayRemove,query,where,deleteField}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore.js";import{getStorage,ref,uploadBytes,getDownloadURL,list,deleteObject}from"https://www.gstatic.com/firebasejs/9.22.1/firebase-storage.js";const API_KEY="AIzaSyDtn21mi-DzG-TGErzkkaNqUifB-cC1KQQ",firebaseConfig={apiKey:API_KEY,authDomain:"lectureseats.firebaseapp.com",projectId:"lectureseats",storageBucket:"lectureseats.appspot.com",messagingSenderId:"911998665124",appId:"1:911998665124:web:27b4b44bcc6cd3b7054131",measurementId:"G-VT95CQX9DC",clientId:"911998665124-be5qcdaj4co3082a7kcn6so1638itpjo.apps.googleusercontent.com"},app=initializeApp(firebaseConfig);window.auth=getAuth(),window.onAuth=e=>onAuthStateChanged(window.auth,e),window.passwordReset=function(e){return sendPasswordResetEmail(window.auth,e+"@caldwell.edu")},window.signIn=function(e,r){return signInWithEmailAndPassword(window.auth,e+"@caldwell.edu",r)},window.signUp=function(e,r){return createUserWithEmailAndPassword(window.auth,e+"@caldwell.edu",r)},window.sendEmailLink=async function(e){localStorage.email=e;try{await sendSignInLinkToEmail(window.auth,e,{url:window.location.href,handleCodeInApp:!0})}catch(e){return{error:e.code}}},window.trySigningInWithLink=async function(){};const storage=getStorage(),downloadURLs={};window.uploadFile=async function(e,r){try{return await uploadBytes(ref(storage,e),r)}catch(e){return{error:e.code}}},window.deleteFiles=async function(e){let r=[],t=new Set,o={};for(let o of(await list(ref(storage,e))).items)try{r.push(await deleteObject(ref(storage,o)))}catch(e){t.add(e.code)}return r.length&&(o.ok=r.length),1===t.size?o.error=[...t][0]:t.size&&(o.error=[...t]),o},window.getLinkFromStoragePath=async function(e){if(e)try{let r=downloadURLs[e];return r||(r=downloadURLs[e]=await getDownloadURL(ref(storage,e))),r}catch(e){return{error:e.code}}};const DATABASE=getFirestore(app);window.db={},window.db.serverTimestamp=serverTimestamp,window.db.Timestamp=Timestamp,window.db.now=()=>Timestamp.now().seconds,window.db.makeTimestamp=function(e,r=0){return e.constructor===Array&&(e=e.join(" ")),db.Timestamp.fromMillis(new Date(e).getTime()+6e4*r)},window.db.deleteField=deleteField,window.db.arrayUnion=arrayUnion,window.db.arrayRemove=arrayRemove,window.db.find=async function(e,...r){if(!navigator.onLine)return{error:"You are offline."};try{if(r)var t=await getDocs(query(collection(DATABASE,e),...r.map((e=>where(...e)))));else t=await getDocs(collection(DATABASE,e));let o={};return t.docs.forEach((e=>o[e.id]=e.data())),o}catch(e){return{error:e.code||"unknown error"}}},window.db.findOne=async function(e,r){if(!navigator.onLine)return{error:"You are offline."};try{var t=await getDoc(doc(DATABASE,e,r));return t.exists()?t.data():null}catch(e){return{error:e.code||"unknown error"}}},window.db.insertOne=async function(e,r,t){if(!navigator.onLine)return{error:"You are offline."};try{if(t){await setDoc(doc(DATABASE,e,t),r);return t}return(await addDoc(collection(DATABASE,e),r)).id}catch(e){return{error:e.code||"unknown error"}}},window.db.updateOne=async function(e,r,t,...o){if(!navigator.onLine)return{error:"You are offline."};try{return o.length?await updateDoc(doc(DATABASE,e,r),t,...o):await updateDoc(doc(DATABASE,e,r),t),!0}catch(e){return{error:e.code||"unknown error"}}},window.db.upsertOne=async function(e,r,t){if(!navigator.onLine)return{error:"You are offline."};try{return await updateDoc(doc(DATABASE,e,r),t),!0}catch(o){return"not-found"===o.code||"permission-denied"===o.code?await window.db.insertOne(e,t,r):{error:o.code||"unknown error"}}};